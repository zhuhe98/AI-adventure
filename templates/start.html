<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ˜Ÿéœ²è°·æ—¶å…‰å’–å•¡é¦† - å†’é™©è®¾ç½®</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
</head>

<body>
    <div class="language-selector" style="position: absolute; top: 1rem; right: 1rem;">
        <select id="language-select" onchange="changeLanguage(this.value)"
            style="padding: 0.5rem; font-family: 'VT323', monospace; font-size: 1.2rem; border: 2px solid var(--border-color); background: var(--panel-bg); color: var(--text-color); cursor: pointer;">
            <option value="zh">ä¸­æ–‡</option>
            <option value="ja">æ—¥æœ¬èª</option>
        </select>
    </div>

    <div class="container start-page">

        <!-- Title Section -->
        <div style="text-align: center; margin-bottom: 2rem;">
            <div style="font-size: 1.5rem; color: var(--primary-color); margin-bottom: 0.5rem;">Stardew Valley Style
            </div>
            <h1 id="main-title"
                style="font-size: 3.5rem; color: var(--secondary-color); text-shadow: 4px 4px 0 var(--bg-color), 6px 6px 0 rgba(0,0,0,0.2);">
                âœ§ æ˜Ÿéœ²è°·æ—¶å…‰å’–å•¡é¦† âœ§</h1>
            <p id="subtitle" style="font-size: 1.2rem; color: #7a6b5d; margin-top: 1rem;">é€‰æ‹©ä½ å–œæ¬¢çš„ä¸»é¢˜å’Œé£æ ¼ï¼Œå¼€å¯ä¸€æ®µå±äºä½ çš„åƒç´ å†’é™©ã€‚</p>
        </div>

        <!-- Settings Form -->
        <div class="pixel-box" style="width: 100%; max-width: 500px; background: var(--panel-bg);">
            <h2 id="settings-title"
                style="text-align: center; margin-bottom: 1.5rem; color: var(--secondary-color); border-bottom: 2px dashed var(--primary-color); padding-bottom: 1rem;">
                âœ¦ å†’é™©è®¾ç½® âœ¦</h2>

            <form id="start-form" onsubmit="handleStart(event)">
                <input type="hidden" name="language" id="language-input" value="zh">

                <div class="form-group">
                    <label id="label-api-key">OpenAI API Key</label>
                    <input type="password" name="api_key" id="input-api-key" placeholder="ä½¿ç”¨ç®¡ç†å‘˜æµ‹è¯•Keyï¼Œæˆ–è¾“å…¥ä½ çš„Key"
                        required
                        style="width: 100%; padding: 0.5rem; font-family: 'VT323', monospace; font-size: 1.2rem; border: 2px solid var(--border-color); background: var(--bg-color); color: var(--text-color);">
                </div>

                <div class="form-group" style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1.5rem;">
                    <input type="checkbox" name="enable_images" id="enable_images" checked
                        style="width: 20px; height: 20px;">
                    <label for="enable_images" id="label-enable-images" style="margin-bottom: 0; cursor: pointer;">ç”Ÿæˆå›¾åƒ
                        (éœ€è¾ƒé•¿æ—¶é—´)</label>
                </div>

                <div class="form-group">
                    <label id="label-theme">é€‰æ‹©å†’é™©ä¸»é¢˜</label>
                    <select name="theme" id="select-theme" required>
                        <option value="coffee">ğŸµ æ—¶é—´å’–å•¡é¦†</option>
                        <option value="school">ğŸ« æ ¡å›­å¥‡é‡</option>
                        <option value="fantasy">ğŸŒŸ å¥‡å¹»ä¸–ç•Œ</option>
                    </select>
                </div>

                <div class="form-group">
                    <label id="label-style">æ•…äº‹é£æ ¼</label>
                    <select name="style" id="select-style" required>
                        <option value="relax">ğŸƒ è½»æ¾æ²»æ„ˆ</option>
                        <option value="mystery">ğŸ” ç¥ç§˜æ‚¬ç–‘</option>
                        <option value="adventure">âš”ï¸ åˆºæ¿€å†’é™©</option>
                    </select>
                </div>

                <div class="form-group">
                    <label id="label-difficulty">æ¸¸æˆéš¾åº¦</label>
                    <select name="difficulty" id="select-difficulty" required>
                        <option value="easy">ğŸŒ± ç®€å•</option>
                        <option value="normal">ğŸŒ¿ æ™®é€š</option>
                        <option value="hard">ğŸŒ³ å›°éš¾</option>
                    </select>
                </div>

                <div class="form-group">
                    <label id="label-custom-intro">è‡ªå®šä¹‰å¼€åœºï¼ˆå¯é€‰ï¼‰</label>
                    <textarea name="custom_intro" id="input-custom-intro" rows="3"
                        placeholder="æˆ‘æ˜¯ä¸€åæ—¶é—´æ—…è¡Œè€…ï¼Œæ­£åœ¨å¯»æ‰¾å¤±è½çš„è®°å¿†..."></textarea>
                </div>

                <button type="submit" class="btn" id="start-btn"
                    style="width: 100%; text-align: center; font-size: 1.5rem; padding: 1rem;">å¼€å§‹å†’é™©</button>
            </form>
        </div>

        <div style="text-align: center; color: var(--primary-color); font-size: 1.5rem; letter-spacing: 5px;">âœ¦ âœ¦ âœ¦
        </div>

    </div>

    <!-- Error Modal -->
    <div id="error-modal" class="modal-overlay"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; justify-content: center; align-items: center;">
        <div class="pixel-box"
            style="background: var(--panel-bg); max-width: 400px; text-align: center; border: 4px solid var(--border-color);">
            <h2 id="error-title" style="color: #d95763; margin-bottom: 1rem;">âš ï¸ éªŒè¯å¤±è´¥</h2>
            <p id="error-message" style="margin-bottom: 1.5rem;">API Key æ— æ•ˆæˆ–æµ‹è¯•å¤±è´¥ã€‚</p>
            <button class="btn" id="error-btn" onclick="closeErrorModal()">ç¡®å®š</button>
        </div>
    </div>

    <script>
        const translations = {
            zh: {
                title: "âœ§ æ˜Ÿéœ²è°·æ—¶å…‰å’–å•¡é¦† âœ§",
                subtitle: "é€‰æ‹©ä½ å–œæ¬¢çš„ä¸»é¢˜å’Œé£æ ¼ï¼Œå¼€å¯ä¸€æ®µå±äºä½ çš„åƒç´ å†’é™©ã€‚",
                settingsTitle: "âœ¦ å†’é™©è®¾ç½® âœ¦",
                apiKeyLabel: "OpenAI API Key",
                apiKeyPlaceholder: "ä½¿ç”¨ç®¡ç†å‘˜æµ‹è¯•Keyï¼Œæˆ–è¾“å…¥ä½ çš„Key",
                enableImagesLabel: "ç”Ÿæˆå›¾åƒ (éœ€è¾ƒé•¿æ—¶é—´)",
                themeLabel: "é€‰æ‹©å†’é™©ä¸»é¢˜",
                styleLabel: "æ•…äº‹é£æ ¼",
                difficultyLabel: "æ¸¸æˆéš¾åº¦",
                customIntroLabel: "è‡ªå®šä¹‰å¼€åœºï¼ˆå¯é€‰ï¼‰",
                customIntroPlaceholder: "æˆ‘æ˜¯ä¸€åæ—¶é—´æ—…è¡Œè€…ï¼Œæ­£åœ¨å¯»æ‰¾å¤±è½çš„è®°å¿†...",
                startBtn: "å¼€å§‹å†’é™©",
                verifying: "éªŒè¯ä¸­...",
                errorTitle: "âš ï¸ éªŒè¯å¤±è´¥",
                errorMessage: "API Key æ— æ•ˆæˆ–æµ‹è¯•å¤±è´¥ã€‚",
                errorBtn: "ç¡®å®š",
                themes: {
                    coffee: "ğŸµ æ—¶é—´å’–å•¡é¦†",
                    school: "ğŸ« æ ¡å›­å¥‡é‡",
                    fantasy: "ğŸŒŸ å¥‡å¹»ä¸–ç•Œ"
                },
                styles: {
                    relax: "ğŸƒ è½»æ¾æ²»æ„ˆ",
                    mystery: "ğŸ” ç¥ç§˜æ‚¬ç–‘",
                    adventure: "âš”ï¸ åˆºæ¿€å†’é™©"
                },
                difficulties: {
                    easy: "ğŸŒ± ç®€å•",
                    normal: "ğŸŒ¿ æ™®é€š",
                    hard: "ğŸŒ³ å›°éš¾"
                }
            },
            ja: {
                title: "âœ§ ã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¥ãƒ¼ãƒ»ã‚«ãƒ•ã‚§ âœ§",
                subtitle: "å¥½ããªãƒ†ãƒ¼ãƒã¨ã‚¹ã‚¿ã‚¤ãƒ«ã‚’é¸ã‚“ã§ã€ã‚ãªãŸã ã‘ã®ãƒ”ã‚¯ã‚»ãƒ«å†’é™ºã‚’å§‹ã‚ã¾ã—ã‚‡ã†ã€‚",
                settingsTitle: "âœ¦ å†’é™ºè¨­å®š âœ¦",
                apiKeyLabel: "OpenAI APIã‚­ãƒ¼",
                apiKeyPlaceholder: "'ç®¡ç†è€…ãƒ†ã‚¹ãƒˆã‚­ãƒ¼ã‚’ä½¿ç”¨ã™ã‚‹ã‹ã€ã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„",
                enableImagesLabel: "ç”»åƒã‚’ç”Ÿæˆ (æ™‚é–“ãŒã‹ã‹ã‚Šã¾ã™)",
                themeLabel: "å†’é™ºã®ãƒ†ãƒ¼ãƒ",
                styleLabel: "ç‰©èªã®ã‚¹ã‚¿ã‚¤ãƒ«",
                difficultyLabel: "é›£æ˜“åº¦",
                customIntroLabel: "ã‚«ã‚¹ã‚¿ãƒ ã‚ªãƒ¼ãƒ—ãƒ‹ãƒ³ã‚°ï¼ˆä»»æ„ï¼‰",
                customIntroPlaceholder: "ç§ã¯ã‚¿ã‚¤ãƒ ãƒˆãƒ©ãƒ™ãƒ©ãƒ¼ã§ã€å¤±ã‚ã‚ŒãŸè¨˜æ†¶ã‚’æ¢ã—ã¦ã„ã¾ã™...",
                startBtn: "å†’é™ºã‚’å§‹ã‚ã‚‹",
                verifying: "æ¤œè¨¼ä¸­...",
                errorTitle: "âš ï¸ æ¤œè¨¼å¤±æ•—",
                errorMessage: "APIã‚­ãƒ¼ãŒç„¡åŠ¹ã‹ã€ãƒ†ã‚¹ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚",
                errorBtn: "ç¢ºèª",
                themes: {
                    coffee: "ğŸµ ã‚¿ã‚¤ãƒ ã‚«ãƒ•ã‚§",
                    school: "ğŸ« å­¦åœ’ã®å¥‡è·¡",
                    fantasy: "ğŸŒŸ ãƒ•ã‚¡ãƒ³ã‚¿ã‚¸ãƒ¼ä¸–ç•Œ"
                },
                styles: {
                    relax: "ğŸƒ ãƒªãƒ©ãƒƒã‚¯ã‚¹",
                    mystery: "ğŸ” ãƒŸã‚¹ãƒ†ãƒªãƒ¼",
                    adventure: "âš”ï¸ å†’é™º"
                },
                difficulties: {
                    easy: "ğŸŒ± ç°¡å˜",
                    normal: "ğŸŒ¿ æ™®é€š",
                    hard: "ğŸŒ³ é›£ã—ã„"
                }
            }
        };

        function changeLanguage(lang) {
            const t = translations[lang];
            document.getElementById('main-title').textContent = t.title;
            document.getElementById('subtitle').textContent = t.subtitle;
            document.getElementById('settings-title').textContent = t.settingsTitle;
            document.getElementById('label-api-key').textContent = t.apiKeyLabel;
            document.getElementById('input-api-key').placeholder = t.apiKeyPlaceholder;
            document.getElementById('label-enable-images').textContent = t.enableImagesLabel;
            document.getElementById('label-theme').textContent = t.themeLabel;
            document.getElementById('label-style').textContent = t.styleLabel;
            document.getElementById('label-difficulty').textContent = t.difficultyLabel;
            document.getElementById('label-custom-intro').textContent = t.customIntroLabel;
            document.getElementById('input-custom-intro').placeholder = t.customIntroPlaceholder;
            document.getElementById('start-btn').textContent = t.startBtn;
            document.getElementById('error-title').textContent = t.errorTitle;
            document.getElementById('error-btn').textContent = t.errorBtn;
            document.getElementById('language-input').value = lang;

            // Update Select Options
            updateSelectOptions('select-theme', t.themes);
            updateSelectOptions('select-style', t.styles);
            updateSelectOptions('select-difficulty', t.difficulties);
        }

        function updateSelectOptions(id, optionsMap) {
            const select = document.getElementById(id);
            for (let i = 0; i < select.options.length; i++) {
                const opt = select.options[i];
                if (optionsMap[opt.value]) {
                    opt.textContent = optionsMap[opt.value];
                }
            }
        }

        // Simple animation for selects
        document.querySelectorAll('select, textarea, input[type="password"]').forEach(el => {
            el.addEventListener('focus', () => {
                el.style.borderColor = 'var(--accent-color)';
                el.style.transform = 'scale(1.02)';
            });
            el.addEventListener('blur', () => {
                el.style.borderColor = 'var(--border-color)';
                el.style.transform = 'scale(1)';
            });
        });

        function closeErrorModal() {
            document.getElementById('error-modal').style.display = 'none';
        }

        async function handleStart(event) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);
            const btn = document.getElementById('start-btn');
            const originalText = btn.textContent;

            btn.textContent = "éªŒè¯ä¸­...";
            btn.disabled = true;

            try {
                const response = await fetch("{{ url_for('start_game') }}", {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (result.success) {
                    window.location.href = result.redirect_url;
                } else {
                    document.getElementById('error-message').textContent = result.error || "API Key éªŒè¯å¤±è´¥ï¼Œè¯·æ£€æŸ¥åé‡è¯•ã€‚";
                    document.getElementById('error-modal').style.display = 'flex';
                    btn.textContent = originalText;
                    btn.disabled = false;
                }
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('error-message').textContent = "ç½‘ç»œé”™è¯¯æˆ–æœåŠ¡å™¨å¼‚å¸¸ã€‚";
                document.getElementById('error-modal').style.display = 'flex';
                btn.textContent = originalText;
                btn.disabled = false;
            }
        }
    </script>
</body>

</html>
